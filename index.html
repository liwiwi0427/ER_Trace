<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ER Trace</title>
    
    <!-- 1. è¼‰å…¥ CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- 2. å®‰å…¨æª¢æŸ¥ -->
    <script>
        if (!localStorage.getItem('ecg_username')) {
            window.location.replace('login.html');
        }
    </script>
</head>
<body>

<!-- SIDEBAR -->
<aside>
    <div class="brand">
        <span>âš¡ER Trace</span>
        <span class="ver-badge">V10.5</span>
    </div>
    
    <!-- é¸å–®ç”± script.js è™•ç†é»æ“Š -->
    <div class="nav-scroll">
        <div class="nav-category">Sinus</div>
        <div class="nav-btn active" onclick="loadCase('nsr')"><span>NSRï¼ˆæ­£å¸¸ç«‡æ€§å¿ƒå¾‹ï¼‰</span><div class="dot norm"></div></div>
        <div class="nav-btn" onclick="loadCase('sb')"><span>Sinus Bradyï¼ˆç«‡æ€§ç·©è„ˆï¼‰</span><div class="dot norm"></div></div>
        
        <div class="nav-category">Atrial</div>
        <div class="nav-btn" onclick="loadCase('psvt')"><span>PSVTï¼ˆå®¤ä¸Šæ€§å¿ƒæéé€Ÿï¼‰</span><div class="dot warn"></div></div>
        <div class="nav-btn" onclick="loadCase('afib')"><span>AFibï¼ˆå¿ƒæˆ¿é¡«å‹•ï¼‰</span><div class="dot warn"></div></div>
        <div class="nav-btn" onclick="loadCase('afl')"><span>A-Flutterï¼ˆå¿ƒæˆ¿æ’²å‹•ï¼‰</span><div class="dot warn"></div></div>

        <div class="nav-category">Ventricular</div>
        <div class="nav-btn" onclick="loadCase('pvc')"><span>PVCï¼ˆå¿ƒå®¤æ—©æœŸæ”¶ç¸®ï¼‰</span><div class="dot warn"></div></div>
        <div class="nav-btn" onclick="loadCase('vt_pulse')"><span>VTï¼ˆå¿ƒå®¤é »è„ˆï¼‰</span><div class="dot crit"></div></div>
        <div class="nav-btn" onclick="loadCase('vt_pulseless')"><span>pVTï¼ˆç„¡è„ˆæ€§VTï¼‰</span><div class="dot crit"></div></div>
        <div class="nav-btn" onclick="loadCase('tdp')"><span>TdPï¼ˆå¤šå‹æ€§VTï¼‰</span><div class="dot crit"></div></div>
        <div class="nav-btn" onclick="loadCase('vf')"><span>VFï¼ˆå¿ƒå®¤é¡«å‹•ï¼‰</span><div class="dot crit"></div></div>

        <div class="nav-category">Blocks & Arrest</div>
        <div class="nav-btn" onclick="loadCase('avb1')"><span>1st Degree AVB</span><div class="dot spec"></div></div>
        <div class="nav-btn" onclick="loadCase('avb2t1')"><span>2nd Degree Type I</span><div class="dot spec"></div></div>
        <div class="nav-btn" onclick="loadCase('avb2t2')"><span>2nd Degree Type II</span><div class="dot spec"></div></div>
        <div class="nav-btn" onclick="loadCase('avb3')"><span>3rd Degree AVB</span><div class="dot spec"></div></div>
        <div class="nav-btn" onclick="loadCase('pea')"><span>PEAï¼ˆç„¡è„ˆæ€§é›»æ´»å‹•ï¼‰</span><div class="dot crit"></div></div>
        <div class="nav-btn" onclick="loadCase('asystole')"><span>Asystoleï¼ˆå¿ƒæåœæ­¢ï¼‰</span><div class="dot crit"></div></div>
    </div>
    
    <div class="sidebar-footer">
        <div class="footer-btn" onclick="toggleTheme()">ğŸŒ—<span>ä¸»é¡Œ</span></div>
        <div class="footer-btn" onclick="openModal()">â„¹ï¸<span>è³‡è¨Š</span></div>
        <div class="footer-btn" onclick="logout()" style="color:#ef4444;">ğŸšª<span>ç™»å‡º</span></div>
    </div>
</aside>

<!-- MAIN CONTENT -->
<main>
    <div class="top-container">
        <!-- Monitor -->
        <div class="monitor-screen">
            <div class="ecg-grid"></div>
            <div class="flash-overlay" id="screen-flash"></div>
            
            <div class="monitor-overlay">
                <div class="monitor-title">LEAD II <span style="font-size:0.8em; opacity:0.7; margin-left:10px;">STAT Monitoring</span></div>
                <!-- åå­—é¡¯ç¤ºä½ç½® -->
                <div id="user-staff-badge">Loading...</div>
            </div>

            <div class="med-log" id="med-log"></div>
            <canvas id="ecgCanvas"></canvas>
        </div>

        <!-- Vitals -->
        <div class="vitals-panel">
            <div class="vital-row c-hr"><div class="vital-label">HR</div><div class="vital-value" id="val-hr">--</div><div class="vital-unit">bpm</div></div>
            <div class="vital-row c-bp">
                <div class="vital-label">NIBP</div>
                <div style="display:flex;align-items:baseline;"><span class="vital-value" id="val-sys">--</span><span style="opacity:0.5;">/</span><span class="vital-value" id="val-dia">--</span></div>
                <div class="vital-unit">mmHg</div>
                <button class="nibp-btn" id="btn-nibp" onclick="toggleNIBP()">Start</button>
            </div>
            <div class="vital-row c-spo2"><div class="vital-label">SpO2</div><div class="vital-value" id="val-spo2">--</div><div class="vital-unit">%</div></div>
            <div class="vital-row c-rr"><div class="vital-label">RESP</div><div class="vital-value" id="val-rr">--</div><div class="vital-unit">rpm</div></div>
            <div class="vital-row c-temp"><div class="vital-label">TEMP</div><div class="vital-value" id="val-temp">--</div><div class="vital-unit">Â°C</div></div>
        </div>

        <!-- Controls -->
        <div class="control-panel">
            <div class="defib-section">
                <div class="energy-lcd"><span id="joule-val">200</span>J</div>
                <div class="defib-btns">
                    <button class="btn-defib btn-charge" id="btn-charge" onclick="charge()">Charge</button>
                    <button class="btn-defib btn-shock" id="btn-shock" onclick="shock()" disabled>Shock</button>
                </div>
            </div>
            <div class="meds-section">
                <div class="meds-title">CRASH CART</div>
                <button class="drug-btn d-aden" onclick="giveDrug('adenosine')"><span>Adenosine</span><span style="opacity:0.6;font-size:0.7rem;">6mg</span></button>
                <button class="drug-btn d-epi" onclick="giveDrug('epi')"><span>Epinephrine</span><span style="opacity:0.6;font-size:0.7rem;">1mg</span></button>
                <button class="drug-btn d-amio" onclick="giveDrug('amio')"><span>Amiodarone</span><span style="opacity:0.6;font-size:0.7rem;">150mg</span></button>
                <button class="drug-btn d-atro" onclick="giveDrug('atropine')"><span>Atropine</span><span style="opacity:0.6;font-size:0.7rem;">1mg</span></button>
                <button class="drug-btn d-mag" onclick="giveDrug('mag')"><span>Magnesium</span><span style="opacity:0.6;font-size:0.7rem;">2g</span></button>
            </div>
        </div>
    </div>

    <!-- Education -->
    <div class="edu-container">
        <div class="anatomy-box">
            <h4 style="color:var(--text-muted); margin-top:0;">é›»ä½å‚³å°è·¯å¾‘</h4>
            <svg class="heart-svg" viewBox="0 0 300 350">
                <path id="heart-muscle" class="path-heart" d="M150 330 C 50 300, 20 180, 20 120 C 20 60, 80 20, 150 90 C 220 20, 280 60, 280 120 C 280 180, 250 300, 150 330 Z" />
                <path class="path-conduction" d="M80 80 Q 115 110 150 140" />
                <path class="path-conduction" d="M150 140 L 150 190 L 100 260 M 150 190 L 200 260" />
                <circle id="node-sa" class="node" cx="80" cy="80" r="8" />
                <circle id="node-av" class="node" cx="150" cy="140" r="6" />
                <rect id="vis-block" class="block-bar" x="135" y="145" width="30" height="8" rx="2" />
                <circle id="vis-psvt" cx="150" cy="140" r="15" fill="none" stroke="#fdd835" stroke-width="3" stroke-dasharray="4,4" style="display:none;" />
                <g id="vis-tdp" style="display:none;">
                    <circle class="flash" cx="120" cy="220" r="6" fill="red" />
                    <circle class="flash" cx="180" cy="250" r="6" fill="red" style="animation-delay:0.2s"/>
                </g>
            </svg>
            <p id="anatomy-text" style="color:var(--text-muted); font-size:0.8rem; text-align:center; margin-top:10px;">Normal</p>
        </div>

        <div class="content-box">
            <div class="content-header">
                <div class="rhythm-title" id="txt-title">NSR</div>
                <span class="rhythm-tag" id="txt-tag" style="background:#4caf50;">Normal</span>
            </div>
            <div class="tabs">
                <button class="tab-btn active" onclick="setTab('overview')">å¤§ç¶±</button>
                <button class="tab-btn" onclick="setTab('patho')">ç—…ç†</button>
                <button class="tab-btn" onclick="setTab('rx')">æ²»ç™‚</button>
            </div>
            <div id="tab-overview" class="tab-content active">
                <h3>ğŸ“Š å¿ƒé›»åœ–ç‰¹å¾µ</h3><ul id="list-criteria"></ul>
                <div id="alert-box" style="padding:10px;border-radius:4px;display:none;"></div>
            </div>
            <div id="tab-patho" class="tab-content">
                <h3>ğŸ§¬ ç—…ç†æ©Ÿè½‰</h3><p id="txt-patho"></p>
                <h3>ğŸ” è‡´ç—…åŸå› </h3><ul id="list-causes"></ul>
            </div>
            <div id="tab-rx" class="tab-content">
                <h3>ğŸ’Š ACLS æ²»ç™‚æŒ‡å¼•</h3><ul id="list-rx"></ul>
                <h3>â¤ï¸ è­·ç†æªæ–½</h3><ul id="list-nurse"></ul>
            </div>
        </div>
    </div>
</main>

<!-- Modal Info -->
<div id="info-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><span>System Info</span><span class="close-btn" onclick="closeModal()">âœ•</span></div>
        <div class="modal-body">
            <div class="log-section">
                <div class="log-title">System Status</div>
                <p>User Logged in as: <span id="modal-user-name"></span></p>
            </div>
            <div class="log-section">
                <div class="log-title">ğŸ“‹ ç‰ˆæœ¬è³‡è¨Š</div>
                <p>ER Traceâ€¢æ€¥è¨ºå¿ƒè·¡</p>
            </div>
        </div>
    </div>
</div>

<!-- 3. è¼‰å…¥è³‡æ–™åº«èˆ‡é‚è¼¯ -->
<script src="data.js"></script>
<script src="script.js"></script>

</body>
</html>